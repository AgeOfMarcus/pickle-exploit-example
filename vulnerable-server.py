from flask import Flask, request
from hackerman import utils
import pickle as cPickle, time

app = Flask(__name__)
keys = {}

@app.route("/new")
def app_newtoken():
	tkn = utils.uid()
	globals()['keys'][tkn] = time.time()
	enc = utils.b64e(cPickle.dumps(tkn))
	return enc

@app.route("/check", methods=['POST']) # vulnerable
def app_check():
	enc = request.form['key']
	tkn = cPickle.loads(utils.b64d(enc))
	if tkn in keys:
		return str(keys[tkn])
	else:
		return "none"

app.run(host="127.0.0.1", port=3333) if __name__ == "__main__" else None
